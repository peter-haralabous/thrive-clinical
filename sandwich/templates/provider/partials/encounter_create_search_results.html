{% if query %}
  {% if context == "encounter_create" %}
    {# Command palette context - use HTMX to load modal #}
    {% for patient in patients %}
      <li>
        <a href="#"
           hx-get="{% url 'providers:encounter_create_select_patient' organization_id=organization.id patient_id=patient.id %}"
           hx-target="#modal-container"
           hx-swap="innerHTML">
          <div>
            <div class="result-content">
              <div class="result-title">{{ patient.last_name }}, {{ patient.first_name }}</div>
              <div class="result-subtitle">{{ patient.email }}</div>
              <div class="result-subtitle">
                DOB: {{ patient.date_of_birth|date:"M d, Y"|default:"None" }} • PHN: {{ patient.phn|default:"None" }}
              </div>
            </div>
            <svg class="result-icon"
                 fill="none"
                 stroke="currentColor"
                 viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </div>
        </a>
      </li>
    {% endfor %}
    <li>
      <a href="{% url 'providers:patient_add' organization_id=organization.id %}?maybe_name={{ query|urlencode }}&return_url={% url 'providers:encounter_list' organization_id=organization.id %}?open_encounter_modal=1">
        <div>
          <div class="result-content">
            <div class="result-title">Create patient "{{ query }}"</div>
          </div>
          <svg class="result-icon"
               fill="none"
               stroke="currentColor"
               viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
        </div>
      </a>
    </li>
  {% else %}
    {# Traditional page context - use button handlers #}
    <div class="dropdown dropdown-open w-full">
      <ul class="dropdown-content bg-base-100 rounded-box w-full shadow-lg border border-base-300 max-h-60 overflow-y-auto">
        {% for patient in patients %}
          <li>
            <button type="button"
                    class="patient-select-btn flex justify-between items-center w-full p-3 hover:bg-base-200 cursor-pointer border-b border-base-300 last:border-b-0"
                    data-patient-id="{{ patient.id }}"
                    data-patient-name="{{ patient.last_name }}, {{ patient.first_name }}"
                    data-patient-email="{{ patient.email }}"
                    data-patient-dob="{{ patient.date_of_birth|date:'M d, Y' }}"
                    data-patient-phn="{{ patient.phn }}">
              <div class="text-left">
                <div class="font-medium">{{ patient.last_name }}, {{ patient.first_name }}</div>
                <div class="text-sm text-base-content/70">{{ patient.email }}</div>
                <div class="text-sm text-base-content/70">
                  DOB: {{ patient.date_of_birth|date:"M d, Y"|default:"None" }} • PHN: {{ patient.phn|default:"None" }}
                </div>
              </div>
              <svg class="w-4 h-4 text-base-content/40"
                   fill="none"
                   stroke="currentColor"
                   viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </button>
          </li>
        {% endfor %}
        <li>
          <a class="patient-create-btn flex justify-between items-center w-full p-3 hover:bg-base-200 cursor-pointer border-b border-base-300 last:border-b-0"
             data-organization-id="{{ organization.id }}">
            <div class="text-left">
              <div class="font-medium">Create patient "{{ query }}"</div>
            </div>
            <svg class="w-4 h-4 text-base-content/40"
                 fill="none"
                 stroke="currentColor"
                 viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </a>
        </li>
      </ul>
    </div>
  {% endif %}
{% endif %}
