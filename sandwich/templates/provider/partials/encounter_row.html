{% load i18n %}
{% load list_helpers %}
{% load lucide %}

{# Encounter row partial: expects encounter, organization, visible_column_meta, optional: oob #}
<tr id="encounter-row-{{ encounter.id }}"
    class="hover:bg-base-50 transition-colors"
    {% if oob_swap %}hx-swap-oob="outerHTML"{% endif %}>
  {% for col in visible_column_meta %}
    {% if col.value == "patient__first_name" %}
      <td>
        <a href="{% url 'providers:encounter' organization_id=organization.id encounter_id=encounter.id %}?slideout=1"
           hx-get="{% url 'providers:encounter' organization_id=organization.id encounter_id=encounter.id %}?slideout=1"
           hx-target="body"
           hx-swap="beforeend"
           class="link">{{ encounter.patient.last_name }}, {{ encounter.patient.first_name }}</a>
      </td>
    {% elif col.value == "patient__email" %}
      <td>{{ encounter.patient.email|default:EMPTY_VALUE_DISPLAY }}</td>
    {% elif col.value == "patient__date_of_birth" %}
      <td>{{ encounter.patient.date_of_birth|date:DJANGO_DATE_FORMAT|default:EMPTY_VALUE_DISPLAY }}</td>
    {% elif col.value == "status" %}
      {% include "provider/partials/inline_edit_display.html" with cell_id="encounter-"|add:encounter.id|stringformat:"s"|add:"-status" field_name="status" display_value=encounter.get_status_display|default:EMPTY_VALUE_DISPLAY can_edit=True encounter=encounter organization=organization %}
    {% elif col.value == "is_active" %}
      <td>{{ encounter.is_active|yesno:"Active,Archived" }}</td>
    {% elif col.value == "created_at" %}
      <td>{{ encounter.created_at|date:DJANGO_DATE_TIME_FORMAT }}</td>
    {% elif col.value == "updated_at" %}
      <td>{{ encounter.updated_at|date:DJANGO_DATE_TIME_FORMAT }}</td>
    {% elif col.is_custom %}
      {% with annotation_name=col.value|custom_attr_name %}
        {% include "provider/partials/inline_edit_display.html" with cell_id="encounter-"|add:encounter.id|stringformat:"s"|add:"-"|add:col.value field_name=col.value display_value=encounter|get_attr:annotation_name|default:EMPTY_VALUE_DISPLAY annotation_name=annotation_name can_edit=True encounter=encounter organization=organization %}
      {% endwith %}
    {% endif %}
  {% endfor %}
  <td class="w-px text-right">{% include "provider/partials/encounter_action_menu.html" with encounter=encounter %}</td>
</tr>
