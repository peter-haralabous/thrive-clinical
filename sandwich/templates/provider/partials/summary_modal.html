{% load lucide %}

<dialog id="summary-modal" class="modal">
  <div class="modal-box max-w-4xl">
    {% include "partials/modal_close_button.html" %}
    <div class="pr-8">
      {% include 'provider/partials/summary_content.html' with title_tag='h3' badge_size='sm' title_class='font-bold text-lg' %}
    </div>
    <div class="divider my-2"></div>
    <div class="flex justify-end mb-4">
      <button class="btn btn-sm btn-outline btn-primary js-copy-summary"
              data-copy-text="{{ summary.body }}">
        {% lucide "copy" class="size-4" %}
        Copy Summary
      </button>
    </div>
    <div class="overflow-y-auto max-h-96 mb-4">
      <div class="rounded-lg border border-base-300 bg-base-50 p-6">
        <div class="prose prose-sm max-w-none">{{ summary.body|safe }}</div>
      </div>
    </div>
    <div class="modal-action">
      <form method="dialog">
        <button class="btn">Close</button>
      </form>
      <a href="{% url 'providers:summary_detail' organization_id=organization.id summary_id=summary.id %}"
         class="btn btn-primary"
         target="_blank">
        {% lucide "external-link" class="size-4" %}
        Open Full Page
      </a>
    </div>
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>
<script nonce="{{ request.csp_nonce }}" type="module">
  const modal = document.getElementById("summary-modal");
  modal.showModal();

  // Remove the modal from DOM when it closes to prevent stale modals from accumulating
  modal.addEventListener("close", () => {
    modal.remove();
  }, {
    once: true
  });
</script>
