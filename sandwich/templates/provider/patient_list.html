{% extends "provider/base.html" %}

{% load sortable %}

{% block main %}
  <h2>Patients</h2>
  <form>
    <div class="mb-2">
      <input name="search"
             type="text"
             class="input"
             placeholder="Search"
             value="{{ search }}" />
      <select name="has_active_encounter" class="input">
        <option value="">All Statuses</option>
        <option value="true"
                {% if has_active_encounter_filter == "true" %}selected{% endif %}>Active</option>
        <option value="false"
                {% if has_active_encounter_filter == "false" %}selected{% endif %}>Archived</option>
      </select>
      <input type="hidden" name="sort" value="{{ sort }}" />
      <button type="submit" class="btn">Search</button>
    </div>
  </form>
  <table class="table">
    <thead>
      <tr>
        <th>{% sortable_column "Name" "first_name" %}</th>
        <th>{% sortable_column "Email" "email" %}</th>
        <th>{% sortable_column "Status" "has_active_encounter" %}</th>
        <th>{% sortable_column "Created" "created_at" %}</th>
        <th>{% sortable_column "Updated" "updated_at" %}</th>
      </tr>
    </thead>
    <tbody>
      {% for patient in patients %}
        <tr>
          <td>
            <a class="link"
               href="{% url "providers:patient" patient_id=patient.id organization_id=organization.id %}">{{ patient.full_name }}</a>
          </td>
          <td>{{ patient.email|default:"â€”" }}</td>
          <td>{{ patient.has_active_encounter|yesno:"Active,Archived" }}</td>
          <td>{{ patient.created_at }}</td>
          <td>{{ patient.updated_at }}</td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="5" class="text-center">No patients found.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
  <!-- Pagination controls -->
  {% if patients.has_other_pages %}
    <nav aria-label="Patient pagination">
      <ul class="pagination">
        {% if patients.has_previous %}
          <li class="page-item">
            <a class="page-link"
               href="?page={{ patients.previous_page_number }}"
               aria-label="Previous">
              <span aria-hidden="true">&laquo; Previous</span>
            </a>
          </li>
        {% else %}
          <li class="page-item disabled">
            <span class="page-link" aria-label="Previous">
              <span aria-hidden="true">&laquo; Previous</span>
            </span>
          </li>
        {% endif %}
        {% if patients.has_next %}
          <li class="page-item">
            <a class="page-link"
               href="?page={{ patients.next_page_number }}"
               aria-label="Next">
              <span aria-hidden="true">Next &raquo;</span>
            </a>
          </li>
        {% else %}
          <li class="page-item disabled">
            <span class="page-link" aria-label="Next">
              <span aria-hidden="true">Next &raquo;</span>
            </span>
          </li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
  <a href="{% url "providers:patient_add" organization_id=organization.id %}"
     class="btn btn-primary">Add a Patient</a>
{% endblock main %}
