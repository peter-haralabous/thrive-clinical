<dialog class="modal" id="add-record-modal">
  <div class="modal-box">
    {% include "partials/modal_close_button.html" %}
    {% include "patient/partials/health_record_add.html" %}
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>
<script nonce="{{ request.csp_nonce }}" type="module">
  const modal = document.getElementById('add-record-modal');
  modal.showModal();
  modal.addEventListener('close', () => {
    // Clear the modal container to avoid CSP violations from history.back()
    // which can trigger HTMX history restoration with inline styles
    document.getElementById('modal-container').innerHTML = '';
  });

  // Make sure HTMX processes the form
  const form = modal.querySelector('form[hx-post]');
  if (form && window.htmx) {
    window.htmx.process(form);
  }
</script>
